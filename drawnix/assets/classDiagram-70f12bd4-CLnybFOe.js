import{s as G,d as S,p as A}from"./styles-9a916d00-NxwAVsA6.js";import{g as v,l as y,d as B,e as W,F as $,B as M,G as I}from"./index-BkkyqH7o.js";import{G as O}from"./graph-CZ97irWc.js";import{l as P}from"./layout-BnX3MQGp.js";import{l as X}from"./line-Du8iVD87.js";import"./index-BZdAMdcy.js";import"./array-BKyUJesY.js";import"./path-CbwjOpE9.js";let H=0;const Y=function(t,e,a,r,i){const n=function(t){switch(t){case i.db.relationType.AGGREGATION:return"aggregation";case i.db.relationType.EXTENSION:return"extension";case i.db.relationType.COMPOSITION:return"composition";case i.db.relationType.DEPENDENCY:return"dependency";case i.db.relationType.LOLLIPOP:return"lollipop"}};e.points=e.points.filter(t=>!Number.isNaN(t.y));const d=e.points,o=X().x(function(t){return t.x}).y(function(t){return t.y}).curve($),s=t.append("path").attr("d",o(d)).attr("id","edge"+H).attr("class","relation");let p,l,c="";r.arrowMarkerAbsolute&&(c=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,c=c.replace(/\(/g,"\\("),c=c.replace(/\)/g,"\\)")),1==a.relation.lineType&&s.attr("class","relation dashed-line"),10==a.relation.lineType&&s.attr("class","relation dotted-line"),"none"!==a.relation.type1&&s.attr("marker-start","url("+c+"#"+n(a.relation.type1)+"Start)"),"none"!==a.relation.type2&&s.attr("marker-end","url("+c+"#"+n(a.relation.type2)+"End)");const g=e.points.length;let h,f,x,u,m=M.calcLabelPosition(e.points);if(p=m.x,l=m.y,g%2!=0&&g>1){let t=M.calcCardinalityPosition("none"!==a.relation.type1,e.points,e.points[0]),r=M.calcCardinalityPosition("none"!==a.relation.type2,e.points,e.points[g-1]);y.debug("cardinality_1_point "+JSON.stringify(t)),y.debug("cardinality_2_point "+JSON.stringify(r)),h=t.x,f=t.y,x=r.x,u=r.y}if(void 0!==a.title){const e=t.append("g").attr("class","classLabel"),i=e.append("text").attr("class","label").attr("x",p).attr("y",l).attr("fill","red").attr("text-anchor","middle").text(a.title);window.label=i;const n=i.node().getBBox();e.insert("rect",":first-child").attr("class","box").attr("x",n.x-r.padding/2).attr("y",n.y-r.padding/2).attr("width",n.width+r.padding).attr("height",n.height+r.padding)}y.info("Rendering relation "+JSON.stringify(a)),void 0!==a.relationTitle1&&"none"!==a.relationTitle1&&t.append("g").attr("class","cardinality").append("text").attr("class","type1").attr("x",h).attr("y",f).attr("fill","black").attr("font-size","6").text(a.relationTitle1),void 0!==a.relationTitle2&&"none"!==a.relationTitle2&&t.append("g").attr("class","cardinality").append("text").attr("class","type2").attr("x",x).attr("y",u).attr("fill","black").attr("font-size","6").text(a.relationTitle2),H++},J=function(t,e,a,r){y.debug("Rendering class ",e,a);const i=e.id,n={id:i,label:e.id,width:0,height:0},d=t.append("g").attr("id",r.db.lookUpDomId(i)).attr("class","classGroup");let o;o=e.link?d.append("svg:a").attr("xlink:href",e.link).attr("target",e.linkTarget).append("text").attr("y",a.textHeight+a.padding).attr("x",0):d.append("text").attr("y",a.textHeight+a.padding).attr("x",0);let s=!0;e.annotations.forEach(function(t){const e=o.append("tspan").text("«"+t+"»");s||e.attr("dy",a.textHeight),s=!1});let p=C(e);const l=o.append("tspan").text(p).attr("class","title");s||l.attr("dy",a.textHeight);const c=o.node().getBBox().height;let g,h,f;if(e.members.length>0){g=d.append("line").attr("x1",0).attr("y1",a.padding+c+a.dividerMargin/2).attr("y2",a.padding+c+a.dividerMargin/2);const t=d.append("text").attr("x",a.padding).attr("y",c+a.dividerMargin+a.textHeight).attr("fill","white").attr("class","classText");s=!0,e.members.forEach(function(e){_(t,e,s,a),s=!1}),h=t.node().getBBox()}if(e.methods.length>0){f=d.append("line").attr("x1",0).attr("y1",a.padding+c+a.dividerMargin+h.height).attr("y2",a.padding+c+a.dividerMargin+h.height);const t=d.append("text").attr("x",a.padding).attr("y",c+2*a.dividerMargin+h.height+a.textHeight).attr("fill","white").attr("class","classText");s=!0,e.methods.forEach(function(e){_(t,e,s,a),s=!1})}const x=d.node().getBBox();var u=" ";e.cssClasses.length>0&&(u+=e.cssClasses.join(" "));const m=d.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",x.width+2*a.padding).attr("height",x.height+a.padding+.5*a.dividerMargin).attr("class",u).node().getBBox().width;return o.node().childNodes.forEach(function(t){t.setAttribute("x",(m-t.getBBox().width)/2)}),e.tooltip&&o.insert("title").text(e.tooltip),g&&g.attr("x2",m),f&&f.attr("x2",m),n.width=m,n.height=x.height+a.padding+.5*a.dividerMargin,n},C=function(t){let e=t.id;return t.type&&(e+="<"+I(t.type)+">"),e},Z=function(t,e,a,r){y.debug("Rendering note ",e,a);const i=e.id,n={id:i,text:e.text,width:0,height:0},d=t.append("g").attr("id",i).attr("class","classGroup");let o=d.append("text").attr("y",a.textHeight+a.padding).attr("x",0);const s=JSON.parse(`"${e.text}"`).split("\n");s.forEach(function(t){y.debug(`Adding line: ${t}`),o.append("tspan").text(t).attr("class","title").attr("dy",a.textHeight)});const p=d.node().getBBox(),l=d.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",p.width+2*a.padding).attr("height",p.height+s.length*a.textHeight+a.padding+.5*a.dividerMargin).node().getBBox().width;return o.node().childNodes.forEach(function(t){t.setAttribute("x",(l-t.getBBox().width)/2)}),n.width=l,n.height=p.height+s.length*a.textHeight+a.padding+.5*a.dividerMargin,n},_=function(t,e,a,r){const{displayText:i,cssStyle:n}=e.getDisplayDetails(),d=t.append("tspan").attr("x",r.padding).text(i);""!==n&&d.attr("style",e.cssStyle),a||d.attr("dy",r.textHeight)},N={getClassTitleString:C,drawClass:J,drawEdge:Y,drawNote:Z};let T={};const E=20,L=function(t){const e=Object.entries(T).find(e=>e[1].label===t);if(e)return e[0]},R=function(t){t.append("defs").append("marker").attr("id","extensionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),t.append("defs").append("marker").attr("id","extensionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z"),t.append("defs").append("marker").attr("id","compositionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","compositionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},F=function(t,e,a,r){const i=v().class;T={},y.info("Rendering diagram "+t);const n=v().securityLevel;let d;"sandbox"===n&&(d=B("#i"+e));const o=B("sandbox"===n?d.nodes()[0].contentDocument.body:"body"),s=o.select(`[id='${e}']`);R(s);const p=new O({multigraph:!0});p.setGraph({isMultiGraph:!0}),p.setDefaultEdgeLabel(function(){return{}});const l=r.db.getClasses(),c=Object.keys(l);for(const t of c){const e=l[t],a=N.drawClass(s,e,i,r);T[a.id]=a,p.setNode(a.id,a),y.info("Org height: "+a.height)}r.db.getRelations().forEach(function(t){y.info("tjoho"+L(t.id1)+L(t.id2)+JSON.stringify(t)),p.setEdge(L(t.id1),L(t.id2),{relation:t},t.title||"DEFAULT")}),r.db.getNotes().forEach(function(t){y.debug(`Adding note: ${JSON.stringify(t)}`);const e=N.drawNote(s,t,i,r);T[e.id]=e,p.setNode(e.id,e),t.class&&t.class in l&&p.setEdge(t.id,L(t.class),{relation:{id1:t.id,id2:t.class,relation:{type1:"none",type2:"none",lineType:10}}},"DEFAULT")}),P(p),p.nodes().forEach(function(t){void 0!==t&&void 0!==p.node(t)&&(y.debug("Node "+t+": "+JSON.stringify(p.node(t))),o.select("#"+(r.db.lookUpDomId(t)||t)).attr("transform","translate("+(p.node(t).x-p.node(t).width/2)+","+(p.node(t).y-p.node(t).height/2)+" )"))}),p.edges().forEach(function(t){void 0!==t&&void 0!==p.edge(t)&&(y.debug("Edge "+t.v+" -> "+t.w+": "+JSON.stringify(p.edge(t))),N.drawEdge(s,p.edge(t),p.edge(t).relation,i,r))});const g=s.node().getBBox(),h=g.width+40,f=g.height+40;W(s,f,h,i.useMaxWidth);const x=`${g.x-E} ${g.y-E} ${h} ${f}`;y.debug(`viewBox ${x}`),s.attr("viewBox",x)},U={draw:F},et={parser:A,db:S,renderer:U,styles:G,init:t=>{t.class||(t.class={}),t.class.arrowMarkerAbsolute=t.arrowMarkerAbsolute,S.clear()}};export{et as diagram};