const CACHE_NAME="eternity-blog-cache-v2",CORE_CACHE_URLS=["/","/manifest.json"],OPTIONAL_CACHE_URLS=["/css/index.css","/js/main.js","/offline/"];async function addToCache(e,s){const t=[];for(const o of s)try{const s=await fetch(o);s.ok?(await e.put(o,s),console.log("âœ… å·²ç¼“å­˜:",o),t.push({url:o,success:!0})):(console.warn("âš ï¸ èµ„æºä¸å¯ç”¨:",o,s.status),t.push({url:o,success:!1,error:`HTTP ${s.status}`}))}catch(e){console.warn("âŒ ç¼“å­˜å¤±è´¥:",o,e.message),t.push({url:o,success:!1,error:e.message})}return t}self.addEventListener("install",e=>{console.log("ðŸ“‹ Service Worker å®‰è£…ä¸­..."),e.waitUntil(caches.open(CACHE_NAME).then(async e=>{console.log("ðŸ“‹ ç¼“å­˜å·²æ‰“å¼€"),console.log("ðŸ“‹ å¼€å§‹ç¼“å­˜æ ¸å¿ƒèµ„æº...");const s=await addToCache(e,CORE_CACHE_URLS);console.log("ðŸ“‹ å¼€å§‹ç¼“å­˜å¯é€‰èµ„æº...");const t=await addToCache(e,OPTIONAL_CACHE_URLS),o=CORE_CACHE_URLS.length+OPTIONAL_CACHE_URLS.length,c=[...s,...t].filter(e=>e.success).length;return console.log(`âœ… ç¼“å­˜åˆå§‹åŒ–å®Œæˆ: ${c}/${o} ä¸ªèµ„æºæˆåŠŸç¼“å­˜`),self.skipWaiting()}).catch(e=>(console.error("âŒ ç¼“å­˜åˆå§‹åŒ–å¤±è´¥:",e),self.skipWaiting())))}),self.addEventListener("activate",e=>{console.log("ðŸ“‹ Service Worker æ¿€æ´»ä¸­..."),e.waitUntil(caches.keys().then(e=>Promise.all(e.map(e=>{if(e!==CACHE_NAME)return console.log("ðŸ“‹ åˆ é™¤æ—§ç¼“å­˜:",e),caches.delete(e)}))).then(()=>(console.log("âœ… Service Worker å·²æ¿€æ´»"),self.clients.claim())))}),self.addEventListener("fetch",e=>{if("GET"!==e.request.method)return;new URL(e.request.url).origin===location.origin&&e.respondWith(caches.match(e.request).then(s=>s?(console.log("ä»Žç¼“å­˜è¿”å›ž:",e.request.url),s):fetch(e.request).then(s=>{if(!s||200!==s.status||"basic"!==s.type)return s;const t=s.clone();return caches.open(CACHE_NAME).then(s=>{e.request.url.match(/\.(html|css|js|png|jpg|jpeg|gif|webp|svg|ico)$/)&&(console.log("ç¼“å­˜æ–°èµ„æº:",e.request.url),s.put(e.request,t))}),s}).catch(()=>{if("navigate"===e.request.mode)return caches.match("/offline/")})))}),console.log("âœ… Service Worker å·²åŠ è½½");